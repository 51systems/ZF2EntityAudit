<h1>Audit Log</h1>

<div class="row">
    <div class="span12">
        <table class="table table-striped table-hover table-bordered">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Revision</th>
                    <th>Timestamp</th>
                    <th>Entities</th>
                    <th>User</th>
                </tr>
            </thead>

            <tfoot>
                <tr>
                    <td colspan="6">
                        <span class="label label-success">Insert</span>
                        <span class="label label-warning">Update</span>
                        <span class="label label-important">Delete</span>
                    </td>
                </tr>
            </tfoot>
            <tbody>
                <?php
                $i = 1 ;
                foreach ($this->paginator as $revision) {
                ?>
                    <tr>
                        <td><?php  echo $this->escapeHtml($i);?></td>
                        <td>
                            <a href="<?=
                                $this->url('audit_viewrevision',
                                    array(
                                        'rev' => $revision->getRev()
                                    )
                                );
                            ?>">
                                <?php  echo $this->escapeHtml($revision->getRev()); ?>
                            </a>
                        </td>

                        <td>
                            <a href="<?=
                                $this->url('audit_viewrevision',
                                    array(
                                        'rev' => $revision->getRev()
                                    )
                                );
                            ?>">
                            
                                <?php echo $this->DateTimeFormatter($revision->getTimestamp()); ?>
                            
                            </a>
                        </td>

                        <td>
                        <?php
                        $changedEntities = $this->auditReader->findEntitesChangedAtRevision($revision->getRev());
                        foreach ($changedEntities as $ce) {
                        ?>
                                <?php $id = $ce->getId(); ?>
                                <a href="<?=
                                    $this->url(
                                        'audit_viewentity',
                                        array(
                                            'id' => $id['id'],
                                            'className' => $ce->getClassName(),
                                        )
                                    );?>">
                            <span class="label label-<?php
                                switch ($ce->getRevisionType()) {
                                    case 'INS':
                                        echo 'success';
                                        break;
                                    case 'UPD':
                                        echo 'warning';
                                        break;
                                    case 'DEL':
                                        echo 'important';
                                        break;
                                    default:
                                        echo 'info';
                                }
                            ?>">


                                    <?php  echo $this->escapeHtml($ce->getClassName()); ?>
                            </span>
                                </a>
                        <br>
                        <?php
                        $i++;
                        }
                        ?>
                        </td>

                        <td>
                            <span class="label label-info">
                                <?php echo  ($this->escapeHtml($revision->getUser()->getEmail())) ?: 'Anonymous'; ?>
                            </span>
                        </td>
                    </tr>
                <?php
                }
                ?>
            </tbody>
        </table>
    </div>
    <div class="span12">
            <?php if ($this->pageCount): ?>
            <div class="pagination pagination-centered">
            <ul>
            <!-- Previous page link -->
            <?php if (isset($this->previous)): ?>
                <li>
                    <a href="<?php echo $this->url($this->route); ?>?page=<?php echo $this->previous; ?>">
                        <<
                    </a>
                </li>
            <?php else: ?>
                <li class="disabled">
                    <a href="#">
                        <<
                    </a>
                </li>
            <?php endif; ?>
            <!-- Numbered page links -->
            <?php foreach ($this->pagesInRange as $page): ?>
                <?php if ($page != $this->current): ?>
                    <li>
                        <a href="<?php echo $this->url($this->route);?>?page=<?php echo $page; ?>">
                            <?php echo $page; ?>
                        </a>
                    </li>
                <?php else: ?>
                    <li class="active">
                        <a href="#"><?php echo $page; ?></a>
                    </li>
                <?php endif; ?>
            <?php endforeach; ?>

            <!-- Next page link -->
            <?php if (isset($this->next)): ?>
                <li>
                    <a href="<?php echo $this->url($this->route); ?>?page=<?php echo $this->next; ?>">
                        >>
                    </a>
                </li>
            <?php else: ?>
                <li class="disabled">
                    <a href="#">
                        >>
                    </a>
                </li>
            <?php endif; ?>
            </ul>
            </div>
            <?php endif; ?>
    </div>
</div>